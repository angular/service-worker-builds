/**
 * @license Angular v6.0.0-rc.1-d37064c
 * (c) 2010-2018 Google, Inc. https://angular.io/
 * License: MIT
 */
!function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?factory(exports,require("@angular/common"),require("@angular/core"),require("rxjs/operators"),require("rxjs")):"function"==typeof define&&define.amd?define(["exports","@angular/common","@angular/core","rxjs/operators","rxjs"],factory):factory((global.ng=global.ng||{},global.ng.serviceWorker={}),global.ng.common,global.ng.core,global.rxjs.operators,global.rxjs)}(this,function(exports,_angular_common,_angular_core,rxjs_operators,rxjs){"use strict";var __assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t},ERR_SW_NOT_SUPPORTED="Service workers are disabled or not supported by this browser";
/**
 * @license Angular v6.0.0-rc.1-d37064c
 * (c) 2010-2018 Google, Inc. https://angular.io/
 * License: MIT
 */
/**
 * @license
 * Copyright Google Inc. All Rights Reserved.
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://angular.io/license
 */var NgswCommChannel=function(){function NgswCommChannel(serviceWorker,platformId){if(this.serviceWorker=serviceWorker,serviceWorker&&_angular_common.isPlatformBrowser(platformId)){var controllerChanges=rxjs.fromEvent(serviceWorker,"controllerchange").pipe(rxjs_operators.map(function(){return serviceWorker.controller})),currentController=rxjs.defer(function(){return rxjs.of(serviceWorker.controller)}),controllerWithChanges=rxjs.concat(currentController,controllerChanges);this.worker=controllerWithChanges.pipe(rxjs_operators.filter(function(c){return!!c})),this.registration=this.worker.pipe(rxjs_operators.switchMap(function(){return serviceWorker.getRegistration()}));var events=rxjs.fromEvent(serviceWorker,"message").pipe(rxjs_operators.map(function(event){return event.data})).pipe(rxjs_operators.filter(function(event){return!!event&&!!event.type})).pipe(rxjs_operators.publish());this.events=events,events.connect()}else this.serviceWorker=void 0,this.worker=this.events=this.registration=(message=ERR_SW_NOT_SUPPORTED,rxjs.defer(function(){return rxjs.throwError(new Error(message))}));var message}return NgswCommChannel.prototype.postMessage=function(action,payload){return this.worker.pipe(rxjs_operators.take(1),rxjs_operators.tap(function(sw){sw.postMessage(__assign({action:action},payload))})).toPromise().then(function(){})},NgswCommChannel.prototype.postMessageWithStatus=function(type,payload,nonce){var waitForStatus=this.waitForStatus(nonce),postMessage=this.postMessage(type,payload);return Promise.all([waitForStatus,postMessage]).then(function(){})},NgswCommChannel.prototype.generateNonce=function(){return Math.round(1e7*Math.random())},NgswCommChannel.prototype.eventsOfType=function(type){return this.events.pipe(rxjs_operators.filter(function(event){return event.type===type}))},NgswCommChannel.prototype.nextEventOfType=function(type){return this.eventsOfType(type).pipe(rxjs_operators.take(1))},NgswCommChannel.prototype.waitForStatus=function(nonce){return this.eventsOfType("STATUS").pipe(rxjs_operators.filter(function(event){return event.nonce===nonce}),rxjs_operators.take(1),rxjs_operators.map(function(event){if(!event.status)throw new Error(event.error)})).toPromise()},Object.defineProperty(NgswCommChannel.prototype,"isEnabled",{get:function(){return!!this.serviceWorker},enumerable:!0,configurable:!0}),NgswCommChannel.ctorParameters=function(){return[null,{type:void 0,decorators:[{type:_angular_core.Inject,args:[_angular_core.PLATFORM_ID]}]}]},NgswCommChannel}(),SwPush=function(){function SwPush(sw){if(this.sw=sw,this.subscriptionChanges=new rxjs.Subject,!sw.isEnabled)return this.messages=rxjs.NEVER,void(this.subscription=rxjs.NEVER);this.messages=this.sw.eventsOfType("PUSH").pipe(rxjs_operators.map(function(message){return message.data})),this.pushManager=this.sw.registration.pipe(rxjs_operators.map(function(registration){return registration.pushManager}));var workerDrivenSubscriptions=this.pushManager.pipe(rxjs_operators.switchMap(function(pm){return pm.getSubscription().then(function(sub){return sub})}));this.subscription=rxjs.merge(workerDrivenSubscriptions,this.subscriptionChanges)}return Object.defineProperty(SwPush.prototype,"isEnabled",{get:function(){return this.sw.isEnabled},enumerable:!0,configurable:!0}),SwPush.prototype.requestSubscription=function(options){var _this=this;if(!this.sw.isEnabled)return Promise.reject(new Error(ERR_SW_NOT_SUPPORTED));for(var pushOptions={userVisibleOnly:!0},key=atob(options.serverPublicKey.replace(/_/g,"/").replace(/-/g,"+")),applicationServerKey=new Uint8Array(new ArrayBuffer(key.length)),i=0;i<key.length;i++)applicationServerKey[i]=key.charCodeAt(i);return pushOptions.applicationServerKey=applicationServerKey,this.pushManager.pipe(rxjs_operators.switchMap(function(pm){return pm.subscribe(pushOptions)}),rxjs_operators.take(1)).toPromise().then(function(sub){return _this.subscriptionChanges.next(sub),sub})},SwPush.prototype.unsubscribe=function(){var _this=this;return this.sw.isEnabled?this.subscription.pipe(rxjs_operators.switchMap(function(sub){if(null!==sub)return sub.unsubscribe().then(function(success){if(!success)throw new Error("Unsubscribe failed!");_this.subscriptionChanges.next(null)});throw new Error("Not subscribed to push notifications.")})).pipe(rxjs_operators.take(1)).toPromise():Promise.reject(new Error(ERR_SW_NOT_SUPPORTED))},SwPush.decorators=[{type:_angular_core.Injectable}],SwPush.ctorParameters=function(){return[{type:NgswCommChannel}]},SwPush}(),SwUpdate=function(){function SwUpdate(sw){if(this.sw=sw,!sw.isEnabled)return this.available=rxjs.NEVER,void(this.activated=rxjs.NEVER);this.available=this.sw.eventsOfType("UPDATE_AVAILABLE"),this.activated=this.sw.eventsOfType("UPDATE_ACTIVATED")}return Object.defineProperty(SwUpdate.prototype,"isEnabled",{get:function(){return this.sw.isEnabled},enumerable:!0,configurable:!0}),SwUpdate.prototype.checkForUpdate=function(){if(!this.sw.isEnabled)return Promise.reject(new Error(ERR_SW_NOT_SUPPORTED));var statusNonce=this.sw.generateNonce();return this.sw.postMessageWithStatus("CHECK_FOR_UPDATES",{statusNonce:statusNonce},statusNonce)},SwUpdate.prototype.activateUpdate=function(){if(!this.sw.isEnabled)return Promise.reject(new Error(ERR_SW_NOT_SUPPORTED));var statusNonce=this.sw.generateNonce();return this.sw.postMessageWithStatus("ACTIVATE_UPDATE",{statusNonce:statusNonce},statusNonce)},SwUpdate.decorators=[{type:_angular_core.Injectable}],SwUpdate.ctorParameters=function(){return[{type:NgswCommChannel}]},SwUpdate}(),RegistrationOptions=function(){return function(){}}(),SCRIPT=new _angular_core.InjectionToken("NGSW_REGISTER_SCRIPT");
/**
 * @license
 * Copyright Google Inc. All Rights Reserved.
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://angular.io/license
 */function ngswAppInitializer(injector,script,options,platformId){return function(){var app=injector.get(_angular_core.ApplicationRef);if(_angular_common.isPlatformBrowser(platformId)&&"serviceWorker"in navigator&&!1!==options.enabled){var whenStable=app.isStable.pipe(rxjs_operators.filter(function(stable){return!!stable}),rxjs_operators.take(1)).toPromise();navigator.serviceWorker.addEventListener("controllerchange",function(){null!==navigator.serviceWorker.controller&&navigator.serviceWorker.controller.postMessage({action:"INITIALIZE"})}),whenStable.then(function(){return navigator.serviceWorker.register(script,{scope:options.scope})})}}}function ngswCommChannelFactory(opts,platformId){return new NgswCommChannel(!1!==opts.enabled?navigator.serviceWorker:void 0,platformId)}var ServiceWorkerModule=function(){function ServiceWorkerModule(){}return ServiceWorkerModule.register=function(script,opts){return void 0===opts&&(opts={}),{ngModule:ServiceWorkerModule,providers:[{provide:SCRIPT,useValue:script},{provide:RegistrationOptions,useValue:opts},{provide:NgswCommChannel,useFactory:ngswCommChannelFactory,deps:[RegistrationOptions,_angular_core.PLATFORM_ID]},{provide:_angular_core.APP_INITIALIZER,useFactory:ngswAppInitializer,deps:[_angular_core.Injector,SCRIPT,RegistrationOptions,_angular_core.PLATFORM_ID],multi:!0}]}},ServiceWorkerModule.decorators=[{type:_angular_core.NgModule,args:[{providers:[SwPush,SwUpdate]}]}],ServiceWorkerModule.ctorParameters=function(){return[]},ServiceWorkerModule}();exports.ServiceWorkerModule=ServiceWorkerModule,exports.SwPush=SwPush,exports.SwUpdate=SwUpdate,exports.ɵe=NgswCommChannel,exports.ɵa=RegistrationOptions,exports.ɵb=SCRIPT,exports.ɵc=ngswAppInitializer,exports.ɵd=ngswCommChannelFactory,Object.defineProperty(exports,"__esModule",{value:!0})});
/**
 * @license Angular v5.0.0-678d1cf
 * (c) 2010-2017 Google, Inc. https://angular.io/
 * License: MIT
 */
!function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?factory(exports,require("@angular/core"),require("rxjs/operator/filter"),require("rxjs/operator/take"),require("rxjs/operator/toPromise"),require("rxjs/observable/concat"),require("rxjs/observable/defer"),require("rxjs/observable/fromEvent"),require("rxjs/observable/of"),require("rxjs/observable/throw"),require("rxjs/operator/do"),require("rxjs/operator/map"),require("rxjs/operator/publish"),require("rxjs/operator/switchMap"),require("rxjs/Subject"),require("rxjs/observable/merge")):"function"==typeof define&&define.amd?define(["exports","@angular/core","rxjs/operator/filter","rxjs/operator/take","rxjs/operator/toPromise","rxjs/observable/concat","rxjs/observable/defer","rxjs/observable/fromEvent","rxjs/observable/of","rxjs/observable/throw","rxjs/operator/do","rxjs/operator/map","rxjs/operator/publish","rxjs/operator/switchMap","rxjs/Subject","rxjs/observable/merge"],factory):factory((global.ng=global.ng||{},global.ng.serviceWorker={}),global.ng.core,global.Rx.Observable.prototype,global.Rx.Observable.prototype,global.Rx.Observable.prototype,global.Rx.Observable,global.Rx.Observable,global.Rx.Observable,global.Rx.Observable,global.Rx.Observable,global.Rx.Observable.prototype,global.Rx.Observable.prototype,global.Rx.Observable.prototype,global.Rx.Observable.prototype,global.Rx,global.Rx.Observable)}(this,function(exports,_angular_core,rxjs_operator_filter,rxjs_operator_take,rxjs_operator_toPromise,rxjs_observable_concat,rxjs_observable_defer,rxjs_observable_fromEvent,rxjs_observable_of,rxjs_observable_throw,rxjs_operator_do,rxjs_operator_map,rxjs_operator_publish,rxjs_operator_switchMap,rxjs_Subject,rxjs_observable_merge){"use strict";function errorObservable(message){return rxjs_observable_defer.defer(function(){return rxjs_observable_throw._throw(new Error(message))})}function ngswAppInitializer(injector,script,options){return function(){var app=injector.get(_angular_core.ApplicationRef);if("serviceWorker"in navigator){var onStable=rxjs_operator_filter.filter.call(app.isStable,function(stable){return!!stable}),isStable=rxjs_operator_take.take.call(onStable,1);rxjs_operator_toPromise.toPromise.call(isStable).then(function(){return navigator.serviceWorker.register(script,options)})}}}function ngswCommChannelFactory(){return new NgswCommChannel(navigator.serviceWorker)}var __assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p])}return t},ERR_SW_NOT_SUPPORTED="Service workers are not supported by this browser",NgswCommChannel=function(){function NgswCommChannel(serviceWorker){if(serviceWorker){var controllerChangeEvents=rxjs_observable_fromEvent.fromEvent(serviceWorker,"controllerchange"),controllerChanges=rxjs_operator_map.map.call(controllerChangeEvents,function(){return serviceWorker.controller}),currentController=rxjs_observable_defer.defer(function(){return rxjs_observable_of.of(serviceWorker.controller)}),controllerWithChanges=rxjs_observable_concat.concat(currentController,controllerChanges);this.worker=rxjs_operator_filter.filter.call(controllerWithChanges,function(c){return!!c}),this.registration=rxjs_operator_switchMap.switchMap.call(this.worker,function(){return serviceWorker.getRegistration()});var rawEvents=rxjs_observable_fromEvent.fromEvent(serviceWorker,"message"),rawEventPayload=rxjs_operator_map.map.call(rawEvents,function(event){return event.data}),eventsUnconnected=rxjs_operator_filter.filter.call(rawEventPayload,function(event){return!!event&&!!event.type}),events=rxjs_operator_publish.publish.call(eventsUnconnected);this.events=events,events.connect()}else this.worker=this.events=errorObservable(ERR_SW_NOT_SUPPORTED)}return NgswCommChannel.prototype.postMessage=function(action,payload){var worker=rxjs_operator_take.take.call(this.worker,1),sideEffect=rxjs_operator_do._do.call(worker,function(sw){sw.postMessage(__assign({action:action},payload))});return rxjs_operator_toPromise.toPromise.call(sideEffect).then(function(){})},NgswCommChannel.prototype.postMessageWithStatus=function(type,payload,nonce){var waitForStatus=this.waitForStatus(nonce),postMessage=this.postMessage(type,payload);return Promise.all([waitForStatus,postMessage]).then(function(){})},NgswCommChannel.prototype.generateNonce=function(){return Math.round(1e7*Math.random())},NgswCommChannel.prototype.eventsOfType=function(type){return rxjs_operator_filter.filter.call(this.events,function(event){return event.type===type})},NgswCommChannel.prototype.nextEventOfType=function(type){return rxjs_operator_take.take.call(this.eventsOfType(type),1)},NgswCommChannel.prototype.waitForStatus=function(nonce){var statusEventsWithNonce=rxjs_operator_filter.filter.call(this.eventsOfType("STATUS"),function(event){return event.nonce===nonce}),singleStatusEvent=rxjs_operator_take.take.call(statusEventsWithNonce,1),mapErrorAndValue=rxjs_operator_map.map.call(singleStatusEvent,function(event){if(!event.status)throw new Error(event.error)});return rxjs_operator_toPromise.toPromise.call(mapErrorAndValue)},NgswCommChannel}(),SwPush=function(){function SwPush(sw){this.sw=sw,this.subscriptionChanges=new rxjs_Subject.Subject,this.messages=rxjs_operator_map.map.call(this.sw.eventsOfType("PUSH"),function(message){return message.data}),this.pushManager=rxjs_operator_map.map.call(this.sw.registration,function(registration){return registration.pushManager});var workerDrivenSubscriptions=rxjs_operator_switchMap.switchMap.call(this.pushManager,function(pm){return pm.getSubscription().then(function(sub){return sub})});this.subscription=rxjs_observable_merge.merge(workerDrivenSubscriptions,this.subscriptionChanges)}return SwPush.prototype.requestSubscription=function(options){for(var _this=this,pushOptions={userVisibleOnly:!0},key=atob(options.serverPublicKey.replace(/_/g,"/").replace(/-/g,"+")),applicationServerKey=new Uint8Array(new ArrayBuffer(key.length)),i=0;i<key.length;i++)applicationServerKey[i]=key.charCodeAt(i);pushOptions.applicationServerKey=applicationServerKey;var subscribe=rxjs_operator_switchMap.switchMap.call(this.pushManager,function(pm){return pm.subscribe(pushOptions)}),subscribeOnce=rxjs_operator_take.take.call(subscribe,1);return rxjs_operator_toPromise.toPromise.call(subscribeOnce).then(function(sub){return _this.subscriptionChanges.next(sub),sub})},SwPush.prototype.unsubscribe=function(){var _this=this,unsubscribe=rxjs_operator_switchMap.switchMap.call(this.subscription,function(sub){if(null!==sub)return sub.unsubscribe().then(function(success){if(success)return void _this.subscriptionChanges.next(null);throw new Error("Unsubscribe failed!")});throw new Error("Not subscribed to push notifications.")}),unsubscribeOnce=rxjs_operator_take.take.call(unsubscribe,1);return rxjs_operator_toPromise.toPromise.call(unsubscribeOnce)},SwPush.decorators=[{type:_angular_core.Injectable}],SwPush.ctorParameters=function(){return[{type:NgswCommChannel}]},SwPush}(),SwUpdate=function(){function SwUpdate(sw){this.sw=sw,this.available=this.sw.eventsOfType("UPDATE_AVAILABLE"),this.activated=this.sw.eventsOfType("UPDATE_ACTIVATED")}return SwUpdate.prototype.checkForUpdate=function(){var statusNonce=this.sw.generateNonce();return this.sw.postMessageWithStatus("CHECK_FOR_UPDATES",{statusNonce:statusNonce},statusNonce)},SwUpdate.prototype.activateUpdate=function(){var statusNonce=this.sw.generateNonce();return this.sw.postMessageWithStatus("ACTIVATE_UPDATE",{statusNonce:statusNonce},statusNonce)},SwUpdate.decorators=[{type:_angular_core.Injectable}],SwUpdate.ctorParameters=function(){return[{type:NgswCommChannel}]},SwUpdate}(),SCRIPT=new _angular_core.InjectionToken("NGSW_REGISTER_SCRIPT"),OPTS=new _angular_core.InjectionToken("NGSW_REGISTER_OPTIONS"),ServiceWorkerModule=function(){function ServiceWorkerModule(){}return ServiceWorkerModule.register=function(script,opts){return void 0===opts&&(opts={}),{ngModule:ServiceWorkerModule,providers:[{provide:SCRIPT,useValue:script},{provide:OPTS,useValue:opts},{provide:NgswCommChannel,useFactory:ngswCommChannelFactory},{provide:_angular_core.APP_INITIALIZER,useFactory:ngswAppInitializer,deps:[_angular_core.Injector,SCRIPT,OPTS],multi:!0}]}},ServiceWorkerModule.decorators=[{type:_angular_core.NgModule,args:[{providers:[SwPush,SwUpdate]}]}],ServiceWorkerModule.ctorParameters=function(){return[]},ServiceWorkerModule}();exports.ServiceWorkerModule=ServiceWorkerModule,exports.SwPush=SwPush,exports.SwUpdate=SwUpdate,exports.ɵe=NgswCommChannel,exports.ɵb=OPTS,exports.ɵa=SCRIPT,exports.ɵc=ngswAppInitializer,exports.ɵd=ngswCommChannelFactory,Object.defineProperty(exports,"__esModule",{value:!0})});
//# sourceMappingURL=/home/travis/build/angular/angular/dist/packages-dist/service-worker/bundles/service-worker.umd.min.js.map
{"version":3,"sources":["/home/travis/build/angular/angular/dist/packages-dist/service-worker/bundles/service-worker.umd.js"],"names":["global","factory","exports","module","require","define","amd","ng","serviceWorker","core","Rx","Observable","prototype","this","_angular_core","rxjs_operator_filter","rxjs_operator_take","rxjs_operator_toPromise","rxjs_observable_concat","rxjs_observable_defer","rxjs_observable_fromEvent","rxjs_observable_of","rxjs_observable_throw","rxjs_operator_do","rxjs_operator_map","rxjs_operator_publish","rxjs_operator_switchMap","rxjs_Subject","rxjs_observable_merge","rxjs_observable_never","errorObservable","message","defer","_throw","Error","ngswAppInitializer","injector","script","options","app","get","ApplicationRef","navigator","enabled","onStable","filter","call","isStable","stable","take","whenStable","toPromise","addEventListener","controller","postMessage","action","then","register","scope","ngswCommChannelFactory","opts","NgswCommChannel","undefined","__assign","Object","assign","t","s","i","n","arguments","length","p","hasOwnProperty","ERR_SW_NOT_SUPPORTED","controllerChangeEvents","fromEvent","controllerChanges","map","currentController","of","controllerWithChanges","concat","worker","c","registration","switchMap","getRegistration","rawEvents","rawEventPayload","event","data","eventsUnconnected","events","publish","connect","payload","sideEffect","_do","sw","postMessageWithStatus","type","nonce","waitForStatus","Promise","all","generateNonce","Math","round","random","eventsOfType","nextEventOfType","statusEventsWithNonce","singleStatusEvent","mapErrorAndValue","status","defineProperty","enumerable","configurable","SwPush","subscriptionChanges","Subject","isEnabled","messages","never","subscription","pushManager","workerDrivenSubscriptions","pm","getSubscription","sub","merge","requestSubscription","_this","reject","pushOptions","userVisibleOnly","key","atob","serverPublicKey","replace","applicationServerKey","Uint8Array","ArrayBuffer","charCodeAt","subscribe","subscribeOnce","next","unsubscribe","success","unsubscribeOnce","decorators","Injectable","ctorParameters","SwUpdate","available","activated","checkForUpdate","statusNonce","activateUpdate","RegistrationOptions","SCRIPT","InjectionToken","ServiceWorkerModule","ngModule","providers","provide","useValue","useFactory","deps","APP_INITIALIZER","Injector","multi","NgModule","args","ɵe","ɵa","ɵb","ɵc","ɵd","value"],"mappings":"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","file":"/home/travis/build/angular/angular/dist/packages-dist/service-worker/bundles/service-worker.umd.min.js","sourcesContent":["/**\n * @license Angular v5.0.5-9dc310e\n * (c) 2010-2017 Google, Inc. https://angular.io/\n * License: MIT\n */\n(function (global, factory) {\n\ttypeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, require('@angular/core'), require('rxjs/operator/filter'), require('rxjs/operator/take'), require('rxjs/operator/toPromise'), require('rxjs/observable/concat'), require('rxjs/observable/defer'), require('rxjs/observable/fromEvent'), require('rxjs/observable/of'), require('rxjs/observable/throw'), require('rxjs/operator/do'), require('rxjs/operator/map'), require('rxjs/operator/publish'), require('rxjs/operator/switchMap'), require('rxjs/Subject'), require('rxjs/observable/merge'), require('rxjs/observable/never')) :\n\ttypeof define === 'function' && define.amd ? define(['exports', '@angular/core', 'rxjs/operator/filter', 'rxjs/operator/take', 'rxjs/operator/toPromise', 'rxjs/observable/concat', 'rxjs/observable/defer', 'rxjs/observable/fromEvent', 'rxjs/observable/of', 'rxjs/observable/throw', 'rxjs/operator/do', 'rxjs/operator/map', 'rxjs/operator/publish', 'rxjs/operator/switchMap', 'rxjs/Subject', 'rxjs/observable/merge', 'rxjs/observable/never'], factory) :\n\t(factory((global.ng = global.ng || {}, global.ng.serviceWorker = {}),global.ng.core,global.Rx.Observable.prototype,global.Rx.Observable.prototype,global.Rx.Observable.prototype,global.Rx.Observable,global.Rx.Observable,global.Rx.Observable,global.Rx.Observable,global.Rx.Observable,global.Rx.Observable.prototype,global.Rx.Observable.prototype,global.Rx.Observable.prototype,global.Rx.Observable.prototype,global.Rx,global.Rx.Observable,global.Rx.Observable));\n}(this, (function (exports,_angular_core,rxjs_operator_filter,rxjs_operator_take,rxjs_operator_toPromise,rxjs_observable_concat,rxjs_observable_defer,rxjs_observable_fromEvent,rxjs_observable_of,rxjs_observable_throw,rxjs_operator_do,rxjs_operator_map,rxjs_operator_publish,rxjs_operator_switchMap,rxjs_Subject,rxjs_observable_merge,rxjs_observable_never) { 'use strict';\n\n/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\n\r\n\r\nvar __assign = Object.assign || function __assign(t) {\r\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n        s = arguments[i];\r\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n    }\r\n    return t;\r\n};\n\n/**\n * @license Angular v5.0.5-9dc310e\n * (c) 2010-2017 Google, Inc. https://angular.io/\n * License: MIT\n */\n/**\n * @fileoverview added by tsickle\n * @suppress {checkTypes} checked by tsc\n */\nvar ERR_SW_NOT_SUPPORTED = 'Service workers are disabled or not supported by this browser';\n/**\n * @record\n */\n\n/**\n * \\@experimental\n * @record\n */\n\n/**\n * \\@experimental\n * @record\n */\n\n/**\n * @param {?} message\n * @return {?}\n */\nfunction errorObservable(message) {\n    return rxjs_observable_defer.defer(function () { return rxjs_observable_throw._throw(new Error(message)); });\n}\n/**\n * \\@experimental\n */\nvar NgswCommChannel = (function () {\n    function NgswCommChannel(serviceWorker) {\n        this.serviceWorker = serviceWorker;\n        if (!serviceWorker) {\n            this.worker = this.events = this.registration = errorObservable(ERR_SW_NOT_SUPPORTED);\n        }\n        else {\n            var /** @type {?} */ controllerChangeEvents = /** @type {?} */ ((rxjs_observable_fromEvent.fromEvent(serviceWorker, 'controllerchange')));\n            var /** @type {?} */ controllerChanges = /** @type {?} */ ((rxjs_operator_map.map.call(controllerChangeEvents, function () { return serviceWorker.controller; })));\n            var /** @type {?} */ currentController = /** @type {?} */ ((rxjs_observable_defer.defer(function () { return rxjs_observable_of.of(serviceWorker.controller); })));\n            var /** @type {?} */ controllerWithChanges = /** @type {?} */ ((rxjs_observable_concat.concat(currentController, controllerChanges)));\n            this.worker = /** @type {?} */ ((rxjs_operator_filter.filter.call(controllerWithChanges, function (c) { return !!c; })));\n            this.registration = /** @type {?} */ ((rxjs_operator_switchMap.switchMap.call(this.worker, function () { return serviceWorker.getRegistration(); })));\n            var /** @type {?} */ rawEvents = rxjs_observable_fromEvent.fromEvent(serviceWorker, 'message');\n            var /** @type {?} */ rawEventPayload = /** @type {?} */ ((rxjs_operator_map.map.call(rawEvents, function (event) { return event.data; })));\n            var /** @type {?} */ eventsUnconnected = /** @type {?} */ ((rxjs_operator_filter.filter.call(rawEventPayload, function (event) { return !!event && !!(/** @type {?} */ (event))['type']; })));\n            var /** @type {?} */ events = /** @type {?} */ ((rxjs_operator_publish.publish.call(eventsUnconnected)));\n            this.events = events;\n            events.connect();\n        }\n    }\n    /**\n     * @internal\n     */\n    /**\n     * \\@internal\n     * @param {?} action\n     * @param {?} payload\n     * @return {?}\n     */\n    NgswCommChannel.prototype.postMessage = /**\n     * \\@internal\n     * @param {?} action\n     * @param {?} payload\n     * @return {?}\n     */\n    function (action, payload) {\n        var /** @type {?} */ worker = rxjs_operator_take.take.call(this.worker, 1);\n        var /** @type {?} */ sideEffect = rxjs_operator_do._do.call(worker, function (sw) {\n            sw.postMessage(__assign({ action: action }, payload));\n        });\n        return /** @type {?} */ ((rxjs_operator_toPromise.toPromise.call(sideEffect).then(function () { return undefined; })));\n    };\n    /**\n     * @internal\n     */\n    /**\n     * \\@internal\n     * @param {?} type\n     * @param {?} payload\n     * @param {?} nonce\n     * @return {?}\n     */\n    NgswCommChannel.prototype.postMessageWithStatus = /**\n     * \\@internal\n     * @param {?} type\n     * @param {?} payload\n     * @param {?} nonce\n     * @return {?}\n     */\n    function (type, payload, nonce) {\n        var /** @type {?} */ waitForStatus = this.waitForStatus(nonce);\n        var /** @type {?} */ postMessage = this.postMessage(type, payload);\n        return Promise.all([waitForStatus, postMessage]).then(function () { return undefined; });\n    };\n    /**\n     * @internal\n     */\n    /**\n     * \\@internal\n     * @return {?}\n     */\n    NgswCommChannel.prototype.generateNonce = /**\n     * \\@internal\n     * @return {?}\n     */\n    function () { return Math.round(Math.random() * 10000000); };\n    /**\n     * @internal\n     */\n    /**\n     * \\@internal\n     * @template T\n     * @param {?} type\n     * @return {?}\n     */\n    NgswCommChannel.prototype.eventsOfType = /**\n     * \\@internal\n     * @template T\n     * @param {?} type\n     * @return {?}\n     */\n    function (type) {\n        return /** @type {?} */ ((rxjs_operator_filter.filter.call(this.events, function (event) { return event.type === type; })));\n    };\n    /**\n     * @internal\n     */\n    /**\n     * \\@internal\n     * @template T\n     * @param {?} type\n     * @return {?}\n     */\n    NgswCommChannel.prototype.nextEventOfType = /**\n     * \\@internal\n     * @template T\n     * @param {?} type\n     * @return {?}\n     */\n    function (type) {\n        return /** @type {?} */ ((rxjs_operator_take.take.call(this.eventsOfType(type), 1)));\n    };\n    /**\n     * @internal\n     */\n    /**\n     * \\@internal\n     * @param {?} nonce\n     * @return {?}\n     */\n    NgswCommChannel.prototype.waitForStatus = /**\n     * \\@internal\n     * @param {?} nonce\n     * @return {?}\n     */\n    function (nonce) {\n        var /** @type {?} */ statusEventsWithNonce = /** @type {?} */ ((rxjs_operator_filter.filter.call(this.eventsOfType('STATUS'), function (event) { return event.nonce === nonce; })));\n        var /** @type {?} */ singleStatusEvent = /** @type {?} */ ((rxjs_operator_take.take.call(statusEventsWithNonce, 1)));\n        var /** @type {?} */ mapErrorAndValue = /** @type {?} */ ((rxjs_operator_map.map.call(singleStatusEvent, function (event) {\n            if (event.status) {\n                return undefined;\n            }\n            throw new Error(/** @type {?} */ ((event.error)));\n        })));\n        return rxjs_operator_toPromise.toPromise.call(mapErrorAndValue);\n    };\n    Object.defineProperty(NgswCommChannel.prototype, \"isEnabled\", {\n        get: /**\n         * @return {?}\n         */\n        function () { return !!this.serviceWorker; },\n        enumerable: true,\n        configurable: true\n    });\n    return NgswCommChannel;\n}());\n\n/**\n * @fileoverview added by tsickle\n * @suppress {checkTypes} checked by tsc\n */\n/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n/**\n * Subscribe and listen to push notifications from the Service Worker.\n *\n * \\@experimental\n */\nvar SwPush = (function () {\n    function SwPush(sw) {\n        this.sw = sw;\n        this.subscriptionChanges = new rxjs_Subject.Subject();\n        if (!sw.isEnabled) {\n            this.messages = rxjs_observable_never.never();\n            this.subscription = rxjs_observable_never.never();\n            return;\n        }\n        this.messages =\n            rxjs_operator_map.map.call(this.sw.eventsOfType('PUSH'), function (message) { return message.data; });\n        this.pushManager = /** @type {?} */ ((rxjs_operator_map.map.call(this.sw.registration, function (registration) { return registration.pushManager; })));\n        var /** @type {?} */ workerDrivenSubscriptions = /** @type {?} */ ((rxjs_operator_switchMap.switchMap.call(this.pushManager, function (pm) { return pm.getSubscription().then(function (sub) { return sub; }); })));\n        this.subscription = rxjs_observable_merge.merge(workerDrivenSubscriptions, this.subscriptionChanges);\n    }\n    Object.defineProperty(SwPush.prototype, \"isEnabled\", {\n        /**\n         * Returns true if the Service Worker is enabled (supported by the browser and enabled via\n         * ServiceWorkerModule).\n         */\n        get: /**\n         * Returns true if the Service Worker is enabled (supported by the browser and enabled via\n         * ServiceWorkerModule).\n         * @return {?}\n         */\n        function () { return this.sw.isEnabled; },\n        enumerable: true,\n        configurable: true\n    });\n    /**\n     * @param {?} options\n     * @return {?}\n     */\n    SwPush.prototype.requestSubscription = /**\n     * @param {?} options\n     * @return {?}\n     */\n    function (options) {\n        var _this = this;\n        if (!this.sw.isEnabled) {\n            return Promise.reject(new Error(ERR_SW_NOT_SUPPORTED));\n        }\n        var /** @type {?} */ pushOptions = { userVisibleOnly: true };\n        var /** @type {?} */ key = atob(options.serverPublicKey.replace(/_/g, '/').replace(/-/g, '+'));\n        var /** @type {?} */ applicationServerKey = new Uint8Array(new ArrayBuffer(key.length));\n        for (var /** @type {?} */ i = 0; i < key.length; i++) {\n            applicationServerKey[i] = key.charCodeAt(i);\n        }\n        pushOptions.applicationServerKey = applicationServerKey;\n        var /** @type {?} */ subscribe = /** @type {?} */ ((rxjs_operator_switchMap.switchMap.call(this.pushManager, function (pm) { return pm.subscribe(pushOptions); })));\n        var /** @type {?} */ subscribeOnce = rxjs_operator_take.take.call(subscribe, 1);\n        return (/** @type {?} */ (rxjs_operator_toPromise.toPromise.call(subscribeOnce))).then(function (sub) {\n            _this.subscriptionChanges.next(sub);\n            return sub;\n        });\n    };\n    /**\n     * @return {?}\n     */\n    SwPush.prototype.unsubscribe = /**\n     * @return {?}\n     */\n    function () {\n        var _this = this;\n        if (!this.sw.isEnabled) {\n            return Promise.reject(new Error(ERR_SW_NOT_SUPPORTED));\n        }\n        var /** @type {?} */ unsubscribe = rxjs_operator_switchMap.switchMap.call(this.subscription, function (sub) {\n            if (sub !== null) {\n                return sub.unsubscribe().then(function (success) {\n                    if (success) {\n                        _this.subscriptionChanges.next(null);\n                        return undefined;\n                    }\n                    else {\n                        throw new Error('Unsubscribe failed!');\n                    }\n                });\n            }\n            else {\n                throw new Error('Not subscribed to push notifications.');\n            }\n        });\n        var /** @type {?} */ unsubscribeOnce = rxjs_operator_take.take.call(unsubscribe, 1);\n        return /** @type {?} */ (rxjs_operator_toPromise.toPromise.call(unsubscribeOnce));\n    };\n    SwPush.decorators = [\n        { type: _angular_core.Injectable },\n    ];\n    /** @nocollapse */\n    SwPush.ctorParameters = function () { return [\n        { type: NgswCommChannel, },\n    ]; };\n    return SwPush;\n}());\n\n/**\n * @fileoverview added by tsickle\n * @suppress {checkTypes} checked by tsc\n */\n/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n/**\n * Subscribe to update notifications from the Service Worker, trigger update\n * checks, and forcibly activate updates.\n *\n * \\@experimental\n */\nvar SwUpdate = (function () {\n    function SwUpdate(sw) {\n        this.sw = sw;\n        if (!sw.isEnabled) {\n            this.available = rxjs_observable_never.never();\n            this.activated = rxjs_observable_never.never();\n            return;\n        }\n        this.available = this.sw.eventsOfType('UPDATE_AVAILABLE');\n        this.activated = this.sw.eventsOfType('UPDATE_ACTIVATED');\n    }\n    Object.defineProperty(SwUpdate.prototype, \"isEnabled\", {\n        /**\n         * Returns true if the Service Worker is enabled (supported by the browser and enabled via\n         * ServiceWorkerModule).\n         */\n        get: /**\n         * Returns true if the Service Worker is enabled (supported by the browser and enabled via\n         * ServiceWorkerModule).\n         * @return {?}\n         */\n        function () { return this.sw.isEnabled; },\n        enumerable: true,\n        configurable: true\n    });\n    /**\n     * @return {?}\n     */\n    SwUpdate.prototype.checkForUpdate = /**\n     * @return {?}\n     */\n    function () {\n        if (!this.sw.isEnabled) {\n            return Promise.reject(new Error(ERR_SW_NOT_SUPPORTED));\n        }\n        var /** @type {?} */ statusNonce = this.sw.generateNonce();\n        return this.sw.postMessageWithStatus('CHECK_FOR_UPDATES', { statusNonce: statusNonce }, statusNonce);\n    };\n    /**\n     * @return {?}\n     */\n    SwUpdate.prototype.activateUpdate = /**\n     * @return {?}\n     */\n    function () {\n        if (!this.sw.isEnabled) {\n            return Promise.reject(new Error(ERR_SW_NOT_SUPPORTED));\n        }\n        var /** @type {?} */ statusNonce = this.sw.generateNonce();\n        return this.sw.postMessageWithStatus('ACTIVATE_UPDATE', { statusNonce: statusNonce }, statusNonce);\n    };\n    SwUpdate.decorators = [\n        { type: _angular_core.Injectable },\n    ];\n    /** @nocollapse */\n    SwUpdate.ctorParameters = function () { return [\n        { type: NgswCommChannel, },\n    ]; };\n    return SwUpdate;\n}());\n\n/**\n * @fileoverview added by tsickle\n * @suppress {checkTypes} checked by tsc\n */\n/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n/**\n * @abstract\n */\nvar RegistrationOptions = (function () {\n    function RegistrationOptions() {\n    }\n    return RegistrationOptions;\n}());\nvar SCRIPT = new _angular_core.InjectionToken('NGSW_REGISTER_SCRIPT');\n/**\n * @param {?} injector\n * @param {?} script\n * @param {?} options\n * @return {?}\n */\nfunction ngswAppInitializer(injector, script, options) {\n    var /** @type {?} */ initializer = function () {\n        var /** @type {?} */ app = injector.get(_angular_core.ApplicationRef);\n        if (!('serviceWorker' in navigator) || options.enabled === false) {\n            return;\n        }\n        var /** @type {?} */ onStable = /** @type {?} */ (rxjs_operator_filter.filter.call(app.isStable, function (stable) { return !!stable; }));\n        var /** @type {?} */ isStable = /** @type {?} */ (rxjs_operator_take.take.call(onStable, 1));\n        var /** @type {?} */ whenStable = /** @type {?} */ (rxjs_operator_toPromise.toPromise.call(isStable));\n        // Wait for service worker controller changes, and fire an INITIALIZE action when a new SW\n        // becomes active. This allows the SW to initialize itself even if there is no application\n        // traffic.\n        navigator.serviceWorker.addEventListener('controllerchange', function () {\n            if (navigator.serviceWorker.controller !== null) {\n                navigator.serviceWorker.controller.postMessage({ action: 'INITIALIZE' });\n            }\n        });\n        // Don't return the Promise, as that will block the application until the SW is registered, and\n        // cause a crash if the SW registration fails.\n        whenStable.then(function () { return navigator.serviceWorker.register(script, { scope: options.scope }); });\n    };\n    return initializer;\n}\n/**\n * @param {?} opts\n * @return {?}\n */\nfunction ngswCommChannelFactory(opts) {\n    return new NgswCommChannel(opts.enabled !== false ? navigator.serviceWorker : undefined);\n}\n/**\n * \\@experimental\n */\nvar ServiceWorkerModule = (function () {\n    function ServiceWorkerModule() {\n    }\n    /**\n     * Register the given Angular Service Worker script.\n     *\n     * If `enabled` is set to `false` in the given options, the module will behave as if service\n     * workers are not supported by the browser, and the service worker will not be registered.\n     */\n    /**\n     * Register the given Angular Service Worker script.\n     *\n     * If `enabled` is set to `false` in the given options, the module will behave as if service\n     * workers are not supported by the browser, and the service worker will not be registered.\n     * @param {?} script\n     * @param {?=} opts\n     * @return {?}\n     */\n    ServiceWorkerModule.register = /**\n     * Register the given Angular Service Worker script.\n     *\n     * If `enabled` is set to `false` in the given options, the module will behave as if service\n     * workers are not supported by the browser, and the service worker will not be registered.\n     * @param {?} script\n     * @param {?=} opts\n     * @return {?}\n     */\n    function (script, opts) {\n        if (opts === void 0) { opts = {}; }\n        return {\n            ngModule: ServiceWorkerModule,\n            providers: [\n                { provide: SCRIPT, useValue: script },\n                { provide: RegistrationOptions, useValue: opts },\n                { provide: NgswCommChannel, useFactory: ngswCommChannelFactory, deps: [RegistrationOptions] },\n                {\n                    provide: _angular_core.APP_INITIALIZER,\n                    useFactory: ngswAppInitializer,\n                    deps: [_angular_core.Injector, SCRIPT, RegistrationOptions],\n                    multi: true,\n                },\n            ],\n        };\n    };\n    ServiceWorkerModule.decorators = [\n        { type: _angular_core.NgModule, args: [{\n                    providers: [SwPush, SwUpdate],\n                },] },\n    ];\n    /** @nocollapse */\n    ServiceWorkerModule.ctorParameters = function () { return []; };\n    return ServiceWorkerModule;\n}());\n\nexports.ServiceWorkerModule = ServiceWorkerModule;\nexports.SwPush = SwPush;\nexports.SwUpdate = SwUpdate;\nexports.ɵe = NgswCommChannel;\nexports.ɵa = RegistrationOptions;\nexports.ɵb = SCRIPT;\nexports.ɵc = ngswAppInitializer;\nexports.ɵd = ngswCommChannelFactory;\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\n})));\n//# sourceMappingURL=service-worker.umd.js.map\n"]}